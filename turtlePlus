-- TurtlePlus by jakemroman

if not fs.exists("/gpi") then
  shell.run("pastebin get Yh0wCDKL /gpi")
end

os.loadAPI("/gpi")

function goTo(tX,tY,tZ)
  x,y,z = gpi.locate()
  if x > tX then
    gpi.setDirection(0)
    while x ~= tX do
      x = x - 1
      if turtle.detect() then
        turtle.dig()
      end
      turtle.attack()
      turtle.forward()
    end
  end
  if x < tX then
    gpi.setDirection(2)
    while x ~= tX do
      x = x + 1
      if turtle.detect() then
        turtle.dig()
      end
      turtle.attack()
      turtle.forward()
    end
  end
  if z > tZ then
    gpi.setDirection(1)
    while z ~= tZ do
      z = z - 1
      if turtle.detect() then
        turtle.dig()
      end
      turtle.attack()
      turtle.forward()
    end
  end
  if z < tZ then
    gpi.setDirection(3)
    while z ~= tZ do
      z = z + 1
      if turtle.detect() then
        turtle.dig()
      end
      turtle.attack()
      turtle.forward()
    end
  end
  if y > tY then
    while y ~= tY do
      y = y - 1
      if turtle.detectDown() then
        turtle.digDown()
      end
      turtle.attackDown()
      turtle.down()
    end
  end
  if y < tY then
    while y ~= tY do
      y = y + 1
      if turtle.detectUp() then
        turtle.digUp()
      end
      turtle.attackUp()
      turtle.up()
    end
  end
end

function saveData()
  f = fs.open("/.turtleData","w")
  f.writeLine(textutils.serialise(turtleData))
  f.close()
end

if not fs.exists("/.turtleData") then
  turtleData = {}
  local x,y,z = gpi.locate()
  local f = gpi.getDirection()
  turtleData["home"] = {
    x = x,
    y = y,
    z = z,
    f = f,
  }
  saveData()
else
  f = fs.open("/.turtleData","r")
  turtleData = textutils.unserialise(f.readAll())
  f.close()
end

function goHome()
  goTo(turtleData["home"]["x"],turtleData["home"]["y"],turtleData["home"]["z"])
  gpi.setDirection(turtleData["home"]["f"])
end
